<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RBX-DOS Terminal</title>
<style>
body {
    background-color: black;
    color: #ccc; /* gray text, no green */
    font-family: "Courier New", monospace;
    padding: 20px;
}

#terminal {
    border: 2px solid #ccc;
    padding: 10px;
    width: 700px;
    height: 500px;
    overflow-y: auto;
    white-space: pre-wrap;
}

input {
    background: black;
    color: #ccc;
    border: none;
    outline: none;
    font-family: "Courier New", monospace;
    font-size: 16px;
    width: 600px;
}

.blink {
    display: inline-block;
    width: 10px;
    background: #ccc;
    animation: blink 1s step-start infinite;
    margin-left: 2px;
}
@keyframes blink {
    50% { background: transparent; }
}

.ascii-img {
    width: 150px;
    border: 1px solid #ccc;
    margin-top: 5px;
}
</style>
</head>
<body>

<div id="terminal"></div>
<div>
<input id="cmdInput" autocomplete="off"><span class="blink">&nbsp;</span>
</div>

<!-- Sound beeps -->
<audio id="beep1" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="beep2" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const term = document.getElementById("terminal");
const input = document.getElementById("cmdInput");
const beep1 = document.getElementById("beep1");
const beep2 = document.getElementById("beep2");

function beep(){ beep1.play(); }
function beepSuccess(){ beep2.play(); }

let commandHistory = [];
let historyIndex = 0;

input.focus();

// COMMAND SYSTEM
input.addEventListener("keydown", async (e)=>{
    if(e.key==="Enter"){
        const cmd = input.value.trim();
        commandHistory.push(cmd);
        historyIndex = commandHistory.length;
        term.innerHTML += `${cmd}\n`;
        input.value = "";
        await handleCommand(cmd);
        term.scrollTop = term.scrollHeight;
    } else if(e.key==="ArrowUp"){
        if(historyIndex>0) historyIndex--;
        input.value = commandHistory[historyIndex]||"";
    } else if(e.key==="ArrowDown"){
        if(historyIndex<commandHistory.length-1) historyIndex++;
        input.value = commandHistory[historyIndex]||"";
    }
});

async function handleCommand(cmd){
    const args = cmd.split(" ");
    const main = args[0].toLowerCase();

    if(main==="profile" && args[1]){
        term.innerHTML += "Loading profile...\n";
        beep();
        await loadProfile(args[1]);
    } else if(main==="avatar" && args[1]){
        term.innerHTML += "Loading avatar...\n";
        beep();
        await loadAvatar(args[1]);
    } else if(main==="help"){
        beep();
        term.innerHTML += "Commands:\n profile <username>\n avatar <username>\n help\n clear\n";
    } else if(main==="clear"){
        beep();
        term.innerHTML = "";
    } else {
        beep();
        term.innerHTML += "Unknown command. Type 'help' for commands.\n";
    }
}

// CORS Roblox API
const corsProxy = "https://corsproxy.io/?"; // Can swap if needed

async function loadProfile(username){
    fakeLoading("ACCESSING ROBLOX DATABASE...", async ()=>{
        try{
            let userRes = await fetch(corsProxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"),{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body: JSON.stringify({usernames:[username]})
            });
            let userData = await userRes.json();
            if(!userData.data || !userData.data[0]){
                term.innerHTML += "ERROR: User not found.\n";
                return;
            }
            const user = userData.data[0];

            // Followers and friends count
            let followersRes = await fetch(corsProxy + encodeURIComponent(`https://friends.roblox.com/v1/users/${user.id}/followers/count`));
            let followers = await followersRes.json();

            let friendsRes = await fetch(corsProxy + encodeURIComponent(`https://friends.roblox.com/v1/users/${user.id}/friends/count`));
            let friends = await friendsRes.json();

            term.innerHTML +=
                `Username: ${user.name}\nDisplay Name: ${user.displayName}\nID: ${user.id}\nDescription: ${user.description||"None"}\nFollowers: ${followers.count}\nFriends: ${friends.count}\n`;

            beepSuccess();
            await showAvatar(user.id);
        } catch{
            term.innerHTML += "ERROR reaching Roblox API.\n";
        }
    });
}

async function showAvatar(id){
    try{
        const res = await fetch(corsProxy + encodeURIComponent(`https://thumbnails.roblox.com/v1/users/avatar?userIds=${id}&size=150x150&format=Png`));
        const data = await res.json();
        if(data.data && data.data[0].imageUrl){
            term.innerHTML += `Avatar:\n<img class="ascii-img" src="${data.data[0].imageUrl}">\n`;
        }
    } catch{
        term.innerHTML += "ERROR loading avatar.\n";
    }
}

async function loadAvatar(username){
    fakeLoading("RETRIEVING AVATAR...", async ()=>{
        try{
            let res = await fetch(corsProxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"),{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body: JSON.stringify({usernames:[username]})
            });
            let data = await res.json();
            if(!data.data || !data.data[0]){
                term.innerHTML += "ERROR: User not found.\n";
                return;
            }
            const user = data.data[0];
            beepSuccess();
            await showAvatar(user.id);
        } catch{
            term.innerHTML += "ERROR retrieving avatar.\n";
        }
    });
}

// FAKE LOADING ANIMATION
function fakeLoading(text, cb){
    term.innerHTML += text + "\n";
    let bar="";
    let step=0;
    const timer = setInterval(()=>{
        beep();
        step++;
        bar += "â–ˆ";
        term.innerHTML = text + "\n[" + bar.padEnd(20,' ') + "] " + (step*5) + "%";
        if(step>=20){
            clearInterval(timer);
            setTimeout(cb, 200);
        }
    },50);
}
</script>

</body>
</html>
