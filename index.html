<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RBX-DOS Terminal</title>
<style>
body {
    background-color: black;
    color: #0f0;
    font-family: "Courier New", monospace;
    padding: 20px;
}

#terminal {
    border: 2px solid #0f0;
    padding: 10px;
    width: 700px;
    height: 500px;
    overflow-y: auto;
    white-space: pre-wrap;
}

input {
    background: black;
    color: #0f0;
    border: none;
    outline: none;
    font-family: "Courier New", monospace;
    font-size: 16px;
    width: 600px;
}

.blink {
    display: inline-block;
    width: 10px;
    background: #0f0;
    animation: blink 1s step-start infinite;
    margin-left: 2px;
}
@keyframes blink {
    50% { background: transparent; }
}

.ascii-img {
    width: 150px;
    border: 1px solid #0f0;
    margin-top: 5px;
}
</style>
</head>
<body>

<div id="terminal"></div>
<div>
<span id="prompt">C:\RBX></span><input id="cmdInput" autocomplete="off"><span class="blink">&nbsp;</span>
</div>

<script>
const term = document.getElementById("terminal");
const input = document.getElementById("cmdInput");
const promptSpan = document.getElementById("prompt");

let commandHistory = [];
let historyIndex = 0;

input.focus();

// Basic command system
input.addEventListener("keydown", async (e)=>{
    if(e.key==="Enter"){
        const cmd = input.value.trim();
        commandHistory.push(cmd);
        historyIndex = commandHistory.length;
        term.innerHTML += `C:\\RBX> ${cmd}\n`;
        input.value = "";

        await handleCommand(cmd);
        term.scrollTop = term.scrollHeight;
    } else if(e.key==="ArrowUp"){
        if(historyIndex>0) historyIndex--;
        input.value = commandHistory[historyIndex]||"";
    } else if(e.key==="ArrowDown"){
        if(historyIndex<commandHistory.length-1) historyIndex++;
        input.value = commandHistory[historyIndex]||"";
    }
});

async function handleCommand(cmd){
    const args = cmd.split(" ");
    const main = args[0].toLowerCase();
    const out = term;

    if(main==="profile" && args[1]){
        const username = args[1];
        out.innerHTML += "Loading profile...\n";
        await loadProfile(username);
    } else if(main==="avatar" && args[1]){
        const username = args[1];
        out.innerHTML += "Loading avatar...\n";
        await loadAvatar(username);
    } else if(main==="help"){
        out.innerHTML += "Commands:\n profile <username>\n avatar <username>\n help\n clear\n";
    } else if(main==="clear"){
        term.innerHTML = "";
    } else {
        out.innerHTML += "Unknown command. Type 'help' for commands.\n";
    }
}

// ------- CORS Roblox API --------
const corsProxy = "https://corsproxy.io/?"; // you can swap a different proxy if this breaks

async function loadProfile(username){
    const out = term;
    try{
        let res = await fetch(corsProxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"),{
            method: "POST",
            headers: { "Content-Type":"application/json" },
            body: JSON.stringify({usernames:[username]})
        });
        let data = await res.json();
        if(!data.data || !data.data[0]){
            out.innerHTML += "ERROR: User not found.\n";
            return;
        }
        const user = data.data[0];

        // friends + followers
        let followersRes = await fetch(corsProxy + encodeURIComponent(`https://friends.roblox.com/v1/users/${user.id}/followers/count`));
        let followers = await followersRes.json();

        let friendsRes = await fetch(corsProxy + encodeURIComponent(`https://friends.roblox.com/v1/users/${user.id}/friends/count`));
        let friends = await friendsRes.json();

        out.innerHTML += `Username: ${user.name}\nDisplay Name: ${user.displayName}\nID: ${user.id}\nDescription: ${user.description||"None"}\nFollowers: ${followers.count}\nFriends: ${friends.count}\n`;

        await showAvatar(user.id);

    } catch(err){
        out.innerHTML += "ERROR reaching Roblox API.\n";
    }
}

async function showAvatar(id){
    const out = term;
    try{
        const res = await fetch(corsProxy + encodeURIComponent(`https://thumbnails.roblox.com/v1/users/avatar?userIds=${id}&size=150x150&format=Png`));
        const data = await res.json();
        if(data.data && data.data[0].imageUrl){
            out.innerHTML += `Avatar:\n<img class="ascii-img" src="${data.data[0].imageUrl}">\n`;
        }
    } catch{
        out.innerHTML += "ERROR loading avatar.\n";
    }
}

async function loadAvatar(username){
    const out = term;
    try{
        let res = await fetch(corsProxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"),{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({usernames:[username]})
        });
        let data = await res.json();
        if(!data.data || !data.data[0]){
            out.innerHTML += "ERROR: User not found.\n";
            return;
        }
        const user = data.data[0];
        await showAvatar(user.id);
    } catch{
        out.innerHTML += "ERROR retrieving avatar.\n";
    }
}
</script>

</body>
</html>
