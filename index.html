<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RBX-DOS Terminal</title>
<style>
body {
    background-color: black;
    color: #ccc;
    font-family: "Courier New", monospace;
    padding: 20px;
}

#terminal {
    border: 2px solid #ccc;
    padding: 10px;
    width: 700px;
    height: 500px;
    overflow-y: auto;
    white-space: pre-wrap;
}

#inputContainer {
    display: flex;
    align-items: center;
    margin-top: 5px;
}

input {
    background: black;
    color: #ccc;
    border: none;
    outline: none;
    font-family: "Courier New", monospace;
    font-size: 16px;
    flex: 1;
    caret-color: #ccc; /* DOS-style blinking cursor */
}

.ascii-img {
    width: 720px;   /* high-res but reliable */
    height: 720px;
    border: 1px solid #ccc;
    margin-top: 5px;
    image-rendering: pixelated;
}
</style>
</head>
<body>

<div id="terminal"></div>
<div id="inputContainer">
    <input id="cmdInput" autocomplete="off" autofocus>
</div>

<!-- Sound beeps -->
<audio id="beep1" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="beep2" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const term = document.getElementById("terminal");
const input = document.getElementById("cmdInput");
const beep1 = document.getElementById("beep1");
const beep2 = document.getElementById("beep2");

function beep(){ beep1.play(); }
function beepSuccess(){ beep2.play(); }

let commandHistory = [];
let historyIndex = 0;
let waitingForUsername = null; // "profile" or "avatar"

input.addEventListener("keydown", async (e)=>{
    if(e.key === "Enter"){
        const cmd = input.value.trim();
        commandHistory.push(cmd);
        historyIndex = commandHistory.length;
        input.value = "";

        if(waitingForUsername){
            const username = cmd;
            if(waitingForUsername === "profile") await loadProfile(username);
            else if(waitingForUsername === "avatar") await loadAvatar(username);
            waitingForUsername = null;
        } else {
            term.innerHTML += cmd + "\n";
            await handleCommand(cmd);
        }
        term.scrollTop = term.scrollHeight;
    } else if(e.key === "ArrowUp"){
        if(historyIndex > 0) historyIndex--;
        input.value = commandHistory[historyIndex] || "";
    } else if(e.key === "ArrowDown"){
        if(historyIndex < commandHistory.length-1) historyIndex++;
        input.value = commandHistory[historyIndex] || "";
    }
});

async function handleCommand(cmd){
    const parts = cmd.trim().split(/\s+/);
    const main = parts[0].toLowerCase();
    const arg = parts[1];

    if(main === "profile"){
        if(arg){
            await loadProfile(arg);
        } else {
            term.innerHTML += "Enter username for profile:\n";
            waitingForUsername = "profile";
        }
    } else if(main === "avatar"){
        if(arg){
            await loadAvatar(arg);
        } else {
            term.innerHTML += "Enter username for avatar:\n";
            waitingForUsername = "avatar";
        }
    } else if(main === "help"){
        beep();
        term.innerHTML += "Commands:\n profile <username>\n avatar <username>\n help\n clear\n";
    } else if(main === "clear"){
        beep();
        term.innerHTML = "";
    } else {
        beep();
        term.innerHTML += "Unknown command. Type 'help' for commands.\n";
    }
}

// --------------- FAKE LOADING BAR ---------------
function randomBetween(min,max){ return min + Math.random()*(max-min); }

async function fakeLoading(text){
    const loadingDiv = document.createElement("div");
    loadingDiv.textContent = text + "\n";
    term.appendChild(loadingDiv);

    const totalDuration = randomBetween(2000,10000); // 2-10 sec
    const barLength = 20;
    let elapsed = 0;

    beep(); // start beep

    while(elapsed < totalDuration){
        const stepTime = randomBetween(50,150);
        await new Promise(r => setTimeout(r, stepTime));
        elapsed += stepTime;

        const progress = Math.min(1, elapsed/totalDuration);
        const filled = Math.floor(progress * barLength);
        const bar = "â–ˆ".repeat(filled).padEnd(barLength,' ');

        loadingDiv.textContent = text + "\n[" + bar + "] " + Math.floor(progress*100) + "%";

        // Random stops
        if(Math.random() < 0.05){
            const stopDuration = randomBetween(500,3000);
            await new Promise(r => setTimeout(r, stopDuration));
        }
    }

    beepSuccess(); // finish beep
}

// --------------- ROBLOX API ---------------
const corsProxy = "https://corsproxy.io/?";

async function loadProfile(username){
    await fakeLoading(`ACCESSING ROBLOX DATABASE FOR ${username}...`);
    try{
        const resUser = await fetch(corsProxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"),{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({usernames:[username]})
        });
        const dataUser = await resUser.json();
        if(!dataUser.data || !dataUser.data[0]){
            term.innerHTML += "ERROR: User not found.\n";
            return;
        }
        const user = dataUser.data[0];

        const followersRes = await fetch(corsProxy + encodeURIComponent(`https://friends.roblox.com/v1/users/${user.id}/followers/count`));
        const followers = await followersRes.json();

        const friendsRes = await fetch(corsProxy + encodeURIComponent(`https://friends.roblox.com/v1/users/${user.id}/friends/count`));
        const friends = await friendsRes.json();

        const profileDiv = document.createElement("div");
        profileDiv.innerHTML = 
            `Username: ${user.name}\n` +
            `Display Name: ${user.displayName}\n` +
            `ID: ${user.id}\n` +
            `Description: ${user.description||"None"}\n` +
            `Followers: ${followers.count}\n` +
            `Friends: ${friends.count}\n`;
        term.appendChild(profileDiv);

        await showAvatar(user.id);

    } catch{
        term.innerHTML += "ERROR reaching Roblox API.\n";
    }
}

async function showAvatar(id){
    try{
        const res = await fetch(corsProxy + encodeURIComponent(
            `https://thumbnails.roblox.com/v1/users/avatar?userIds=${id}&size=720x720&format=Png`
        ));
        const data = await res.json();
        if(data.data && data.data[0].imageUrl){
            const imgDiv = document.createElement("div");
            imgDiv.innerHTML = `<img class="ascii-img" src="${data.data[0].imageUrl}">`;
            term.appendChild(imgDiv);
        } else {
            term.innerHTML += "Avatar unavailable at this resolution.\n";
        }
    } catch{
        term.innerHTML += "ERROR loading avatar.\n";
    }
}

async function loadAvatar(username){
    await fakeLoading(`RETRIEVING AVATAR FOR ${username}...`);
    try{
        const res = await fetch(corsProxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"),{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({usernames:[username]})
        });
        const data = await res.json();
        if(!data.data || !data.data[0]){
            term.innerHTML += "ERROR: User not found.\n";
            return;
        }
        const user = data.data[0];
        await showAvatar(user.id);
    } catch{
        term.innerHTML += "ERROR retrieving avatar.\n";
    }
}
</script>

</body>
</html>
